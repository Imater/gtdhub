<div class="stages-wrap">

    <div>
        <ul class="stage-ul" ng-if="stages.length">
            <li ng-repeat="stage in stages" class="stage-li">
                <div ng-include="'/stage-column.html'"></div>
            </li>
        </ul>
    </div>

</div>

<script type="text/ng-template" id="/stage-column.html">
    <div class="stage-line">
        <a class="title-wrap"
           ui-sref="cards.tree({id:tree.id})">
            <div class="title">{{stage.title}}</div>
        </a>
        <ul class="task-ul">
            <li ng-repeat="task in stage.tasks" class="task-li">
                {{task.title}}
            </li>
            <li ng-if="isTaskEditShown(stage)"
                class="task-li editor editor-{{stage.id}}"
                contenteditable="true"
                ng-model="newTask.title">
            </li>
            <li class="btn-wrap" ng-if="isTaskEditShown(stage)">
                <a class="btn btn-success btn-xs"
                   ng-click="saveTask(stage)">
                    Save
                </a>
                <a class="btn btn-default btn-xs pull-right"
                   ng-click="cancelAddTask()">
                    Cancel
                </a>
            </li>
            <li class="add-task"
                ng-if="!isTaskEditShown(stage)"
                ng-click="addTask(stage)">
                Add card...
            </li>
        </ul>
    </div>
</script>